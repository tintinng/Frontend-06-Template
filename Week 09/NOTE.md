学习笔记
## HTML解析
- HTML parse模块的文件拆分
- 使用FSM实现HTML的分析
  - 在HTML标准中，已经规定了HTML的状态
  - Toy-Browser只挑选其中一部分状态

### 解析标签
- 开始标签
- 结束标签
- 子封闭标签

### 创建元素
- 在解析html标签的状态机种加入业务逻辑
  - 创建token，记录当前的token
- 在结束标签状态提交标签token

### 处理属性
- 属性值分为单引号、双引号和无引号三种写法
- 属性结束时将属性加到标签Token上

### 使用token构建DOM树
- 使用站构建DOM树
  - 遇到开始标签时创建元素并入栈，遇到结束标签时出栈
  - 自封闭节点可视为入栈后立即出栈
  - 任何元素的父元素时它入栈前的栈顶元素（构建双向关系）

### 处理文本节点
- 文本节点与自封闭标签处理类似
- 多个文本节点需要合并

## CSS计算
### 收集CSS规则
- 调用CSS Parser来生成抽象语法树AST
### 添加调用
- 计算CSS时机：创建一个元素的时候
### 获取父元素序列
- 必须知道元素的父元素才能判断元素与规则是否匹配
- 可以从stack中获取
### 选择器与元素的匹配
- 选择器要从当前元素向外排列
- 复杂选择器要拆成针对单个元素的选择器，用循环匹配父元素队列
### 计算选择器与元素的匹配
- 根据选择器的类型和元素属性，计算是否与当前元素匹配
### 生成computed属性
- 匹配上就遍历声明块，形成computedStyle
### specificity的计算逻辑
- 四元组，越往左权重越高
```css
四元组：[inline, id, class, tag]
// 从左向右比较
div div #id : [0, 1, 0, 2]
div .cls #id: [0, 1, 1, 1]
```
- CSS规则根据specificity和后来优先规则覆盖